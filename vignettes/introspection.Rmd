---
title: "Meetup API Schema Introspection"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Meetup API Schema Introspection}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
#| include: false
#| label: setup

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = TRUE
)
vcr::local_vcr_configure_log()

vcr::setup_knitr(prefix = "introsp-")
meetupr:::mock_if_no_auth()
Sys.setenv(MEETUPR_DEBUG = "")
```


The meetupr package provides powerful introspection functions to explore the Meetup GraphQL API schema. 
This allows you to understand available data and build custom queries, as demonstrated in the [Custom Meetup Queries](graphql.html), efficiently.

## Practical Workflow

1. Use `explore_query_fields()` to see top-level fields
2. Search for relevant types with `search_types()`
3. Examine specific type fields with `get_type_fields()`
4. Build and test queries in the [Meetup API Playground](https://www.meetup.com/api/playground)
5. Execute with `meetup_query()`

This approach lets you efficiently discover and utilize the full Meetup API schema for custom data extraction beyond the package's built-in functions.

## Basic Introspection

Start by examining the full schema:

```{r}
#| label: schema
#| cassette: true

library(meetupr)

schema <- meetup_introspect()
```

## Exploring Available Queries

Get an overview of all query fields:

```{r}
#| label: query-fields

query_fields <- explore_query_fields(schema)
query_fields
```

This shows field names, descriptions, argument counts, and return types. For example, you might see fields like `event`, `group`, `self`, etc.

## Finding Specific Types

Search for types related to your interests:

```{r}
#| label: search-types

event_types <- search_types(schema, pattern = "event")
event_types

user_types <- search_types(schema, pattern = "user")
user_types
```

## Examining Type Fields

Once you find a relevant type, examine its available fields:

```{r}
#| label: type-fields

event_fields <- get_type_fields(schema, "Event")
event_fields

group_fields <- get_type_fields(schema, "Group")
group_fields
```

## Building Custom Queries

Use the introspection data to construct targeted queries with `meetup_query()`:

```{r}
#| label: custom-build

custom_query <- "
query($eventId: ID!) {
  event(id: $eventId) {
    title
    description
    dateTime
    venues {
      name
      address
    }
    group {
      name
      urlname
    }
  }
}"
```

In this example, we fetch event details including title, description, date/time, venue info, and associated group details.
It sets up a variable `$eventId` for flexibility, which can be passed when calling `meetup_query()`, allowing reuse for different events.

```{r}
#| label: custom-query
#| cassette: true

result <- meetup_query(custom_query, eventId = "103349942")
result
```

## Finding Available Mutations

In GraphQL, mutations are used to modify data.
They are less commonly used for data retrieval, but it's useful to know what's available.
Mutations allow creating, updating, or deleting resources, and typical use cases would involve managing events, RSVPs, or group details.
Mutations will require users to have appropriate permissions to perform these actions.
Check what mutations are available:

```{r}
#| label: mutations
mutations <- explore_mutations(schema)
mutations
```

Available mutations might include actions like `createEvent`, `updateEvent`, `deleteEvent`, etc.

### Building Mutation Queries

To build a mutation query, you would follow a similar process as with queries.
For example, to create a new event, you might construct a mutation like this:

```{r}
#| label: mutation-build
#| eval: false

mutation_query <- "
mutation($input: CreateEventInput!) {
  createEvent(input: $input) {
    event {
      id
      title
      dateTime
    }
  }
}"

# Example input for creating an event
input_data <- list(
  title = "New Meetup Event",
  description = "Description of the new event",
  dateTime = "2024-07-01T18:00:00Z",
  groupId = "123456"
)

# Execute the mutation (requires appropriate permissions)
meetup_query(mutation_query, input = input_data)
```
