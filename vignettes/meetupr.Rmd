---
title: "Setting up and Getting Started with meetupr"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Setting up and Getting Started with meetupr}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r}
#| include: false
#| label: setup

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  eval = TRUE
)

vcr::setup_knitr(prefix = "meetupr-")
meetupr:::mock_if_no_auth()
meetupr::local_meetupr_debug(0)
```

```{r}
#| label: load
library(meetupr)
```

## Quick Setup Check

Start by running `meetup_sitrep()` to set up authentication or check your authentication status:

```{r}
#| label: sitrep
#| cassette: true

meetup_sitrep()
```

This function will show you:  
- Which authentication method is active  
- Whether your credentials are properly configured  
- API connectivity status  
- Setup instructions if authentication is missing  

## Authentication Methods

Authentication is required to access the Meetup API.
When you first install and load the `meetupr` package, you can use built-in credentials for basic access.
You authenticate by running `meetup_auth()`, (or any querying functino) which opens a browser window for OAuth login.
You provide consent for the app to use your Meetup account to retrieve data.

meetupr supports two authentication methods:

### OAuth Authentication (Interactive)

Best for interactive development, data exploration, and one-off analyses.

**Setup:**

```r
# Authenticate interactively (opens browser)
meetup_auth()

# Check authentication status
meetup_auth_status()
```

The OAuth token is cached locally in your httr2 cache directory. 
Token files follow the pattern: `{hash}-token.rds.enc`

### CI/CD Authentication (Non-Interactive)

For automated workflows, you can set up token-based authentication:

#### 1. Authenticate locally first:

```r
meetup_auth()
meetup_auth_setup_ci()
```

This encodes your token as base64 and provides instructions for setting CI secrets.
It will also store this information using the [keyring](https://keyring.r-lib.org/) package.

#### 2. Set environment variables in your CI

- `MEETUP_TOKEN` - Base64-encoded token (from step 1)  
- `MEETUP_TOKEN_FILE` - Token filename (e.g., `ae743e0-token.rds.enc`)  

#### 3. Token loads automatically in CI

To make the authentication work in CI/CD pipelines, add this line before running any API calls:

```r
meetup_auth_load_ci()
```

## Variables Reference

| Variable | Required | Purpose |
|----------|----------|---------|
| `MEETUP_CLIENT_ID` | No* | OAuth client ID |
| `MEETUP_CLIENT_SECRET` | No* | OAuth client secret |
| `MEETUP_CLIENT_NAME` | No | OAuth client name (default: "meetupr") |
| `MEETUP_TOKEN` | for CI | Base64-encoded OAuth token |
| `MEETUP_TOKEN_FILE` | for CI | Token filename |
| `MEETUPR_DEBUG` | No | Enable debug output ("1" = on) |

\* Built-in credentials are used if not provided, and Meetup clients are only available for approved apps from Pro (paid) accounts.

### Setting Credentials using Keyring

Instead of using environment variables, you can securely store and retrieve credentials using the system keyring with the `meetup_key_set()` and `meetup_key_get()` functions.

#### Storing Credentials

```r
# Store client ID and secret in keyring
meetup_key_set("client_id", "your_client_id")
meetup_key_set("client_secret", "your_secret")
```

If you don't provide a value, you will be prompted to input it interactively.

Using Stored Credentials
When authentication is needed, the meetupr package will automatically retrieve the stored credentials:


```r
# Retrieve client ID and secret (used internally by meetupr)
client_id <- meetup_key_get("client_id")
client_secret <- meetup_key_get("client_secret")
```

### Verification

After storing your credentials in the keyring, you can verify the setup:

```{r}
#| label: verify-sitrep
#| cassette: true
meetup_sitrep()
```

## Basic Usage Examples

### Get Group Information

```{r}
#| label: group-info
#| cassette: true
group_info <- get_group("rladies-lagos")
str(group_info)
```

### List Upcoming Events

```{r}
#| label: upcoming-events
#| cassette: true
events <- get_events("rladies-lagos")
head(events)
```

### Search for Groups

```{r}
#| label: search-groups
#| cassette: true
r_groups <- find_groups("R programming")
head(r_groups)
```

## Debug Mode

Sometimes issues arise due to misconfiguration.
Enabling debugging mode provides more information on what is sent to the API, i.e. the full graphql query.
Enable debugging mode by setting system variable "MEETUPR_DEBUG" to 1 (0 or missing means no debugging):

```{r}
#| label: debug
#| cassette: true

local_meetupr_debug(1)
meetup_sitrep()
find_groups("R programming")
```

to turn it off again, set it to 0 or unset it:

```{r}
#| label: debug-off
#| cassette: true

local_meetupr_debug(0)
meetup_sitrep()
find_groups("R programming")
```

## Common Issues

### Authentication Errors

```r
Error: Authentication required
```

**Solution**: Run `meetup_sitrep()` to diagnose authentication issues.

### Invalid RSA Key

```r
Error: RSA private key not found
```

**Solution**: Verify your RSA key format includes header/footer lines and is properly formatted.

### Rate Limiting

```r
Error: Rate limit exceeded
```

**Solution**: Implement delays between requests or use caching strategies.


## Next Steps

- **For R-Ladies chapter management**: See [R-Ladies vignette](rladies.html)  
- **For custom GraphQL queries**: See [GraphQL vignette](graphql.html)`
